<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>解决SSPANEL NAT机中转台湾家宽问题</title>
      <link href="/posts/3055/"/>
      <url>/posts/3055/</url>
      
        <content type="html"><![CDATA[<blockquote><p>问题：直接对接台湾家宽，速度不理想，想到了用nat机中转，但是面板ip地址那里是不变化的，台湾家宽两天变动一次，两天手动改ip太麻烦，就写了一个shell脚本清理缓存dns以后解析域名的ip，并实时传递到数据库，从而避免手动改ip 的麻烦！</p></blockquote><h4 id="1-脚本"><a href="#1-脚本" class="headerlink" title="1.脚本"></a>1.脚本</h4><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! bin/bash</span></span><br><span class="line">systemctl start nscd   <span class="comment">#需要安装  yum install -y nscd</span></span><br><span class="line">name=`host 域名 | cut -d <span class="string">&#x27; &#x27;</span> -f4`</span><br><span class="line">mysql -u用户名 -p密码  &lt;&lt;EOF</span><br><span class="line">update 数据库.表 <span class="built_in">set</span> node_ip = <span class="string">&quot;<span class="variable">$name</span>&quot;</span> <span class="built_in">where</span> id = 需要改动的节点id;</span><br><span class="line">quit</span><br><span class="line">EOF</span><br></pre></td></tr></table></figure><div class="note info">            <p>shell脚本在数据库所在的机器运行</p>          </div><h4 id="2-添加定时任务"><a href="#2-添加定时任务" class="headerlink" title="2.添加定时任务"></a>2.添加定时任务</h4><blockquote><p>我的脚本在主目录下，<code>crontab -e</code> 进入定时任务，在最后一行加入</p></blockquote><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">*/1 * * * * sh /root/test.sh</span><br></pre></td></tr></table></figure><div class="note info">            <p>运行时间可根据自己的需求进行修改</p>          </div>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSPANEL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>利用github备份自己的网站数据</title>
      <link href="/posts/27296/"/>
      <url>/posts/27296/</url>
      
        <content type="html"><![CDATA[<blockquote><p>注：原文出处在这里哦<a href="https://moe.best/gotagota/backup-to-github.html">原文链接</a></p></blockquote><h2 id="准备"><a href="#准备" class="headerlink" title="准备"></a>准备</h2><ul><li><p>github 账户</p></li><li><p>网站服务器</p></li></ul><h2 id="1、开始"><a href="#1、开始" class="headerlink" title="1、开始"></a>1、开始</h2><ul><li>然后接下来是在服务器上的操作：</li></ul><ul><li>进入一个你喜欢的安全的目录，此处直接以 <code>/root</code>为例</li></ul><ul><li>参考下命令创建一个 RSA 密匙</li></ul><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> /root</span><br><span class="line">ssh-keygen -t rsa</span><br></pre></td></tr></table></figure><p>然后根据提示输入生成密匙的文件名，此处举例输入 <code>github</code>，要你输入 passphrase 的时候直接不输入回车就行<br>完成后会有类似这样的显示，并且你会在当前目录下得到 <code>github</code>和 <code>github.pub</code>这两个文件；<img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/xiaoyanggo/CDN@master/Blog/%E5%88%A9%E7%94%A8github%E5%A4%87%E4%BB%BD%E7%BD%91%E7%AB%99%E6%95%B0%E6%8D%AE/%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE1.png"><br>接着用 <code>cat</code>命令查看 <code>github.pub</code>文件的内容，并复制下来</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cat github.pub</span><br></pre></td></tr></table></figure><p>回到你的 Github 页面，点右上角头像，Settings，左边“SSH and GPG keys”，右上角“New SSH key”</p><p>然后将刚才复制的内容粘贴到“Key”输入框中，上方的“Tittle”自己随意输入，然后“Add SSH key”</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/xiaoyanggo/CDN@master/Blog/%E5%88%A9%E7%94%A8github%E5%A4%87%E4%BB%BD%E7%BD%91%E7%AB%99%E6%95%B0%E6%8D%AE/%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE2.png"></p><p>这样事前准备就完成了，嗯，其实就是加一个 SSH 密匙到 Github，这样可以方便后续 Github 项目的同步</p><h2 id="2、创建一个私密-Github-项目"><a href="#2、创建一个私密-Github-项目" class="headerlink" title="2、创建一个私密 Github 项目"></a>2、创建一个私密 Github 项目</h2><p>直接右上角新建项目</p><p><img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/xiaoyanggo/CDN@master/Blog/%E5%88%A9%E7%94%A8github%E5%A4%87%E4%BB%BD%E7%BD%91%E7%AB%99%E6%95%B0%E6%8D%AE/%E6%95%B0%E6%8D%AE%E5%A4%87%E4%BB%BD3_1.png"></p><h2 id="3、在你的站点目录下初始化你的-Github-项目"><a href="#3、在你的站点目录下初始化你的-Github-项目" class="headerlink" title="3、在你的站点目录下初始化你的 Github 项目"></a>3、在你的站点目录下初始化你的 Github 项目</h2><p>进入你的站点所在目录，并执行一系列 git 初始化命令，参考以下代码</p><p>假设我的网站在 <code>/www/wwwroot/xxx.com</code>，Github 项目为 <code>xiaoyanggo/test</code></p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /www/wwwroot/xxx.com</span><br><span class="line">git init</span><br><span class="line">git remote add origin git@github.com:xiaoyanggo/test.git</span><br></pre></td></tr></table></figure><h2 id="4、尝试同步当前站点到-Github-项目"><a href="#4、尝试同步当前站点到-Github-项目" class="headerlink" title="4、尝试同步当前站点到 Github 项目"></a>4、尝试同步当前站点到 Github 项目</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /www/wwwroot/xxx.com</span><br><span class="line">git add -A</span><br><span class="line">git commit -m &quot;backup&quot;</span><br><span class="line">ssh-agent bash</span><br><span class="line">ssh-add /root/github</span><br><span class="line">git push -u origin master -f #原文作者没有加-f导致同步失败，加上-f解决。</span><br></pre></td></tr></table></figure><h3 id="命令解释"><a href="#命令解释" class="headerlink" title="命令解释"></a>命令解释</h3><ol><li>进入网站目录</li><li>把目录下所有文件变化（增、删、改）提交到暂存区<br>如果你想只增、改而不删，那么可以用<code>git add .</code>命令代替</li><li>提交所有更改，这个<code>&quot;backup&quot;</code>可以随意填写，没有影响，其实就是你提交改动的时候的说明，但是 commit 的时候必须要有这个说明</li><li>启动 SSH 密钥管理器</li><li>将之前我们创建的<code>github</code>密匙文件添加到密匙管理器中</li><li>推送所有更改到 Github 项目<img src= "/img/loading.gif" data-lazy-src="https://cdn.jsdelivr.net/gh/xiaoyanggo/CDN@master/Blog/%E5%88%A9%E7%94%A8github%E5%A4%87%E4%BB%BD%E7%BD%91%E7%AB%99%E6%95%B0%E6%8D%AE/%E5%A4%87%E4%BB%BD%E6%95%B0%E6%8D%AE4.png"></li></ol><h2 id="5、设定每天自动同步"><a href="#5、设定每天自动同步" class="headerlink" title="5、设定每天自动同步"></a>5、设定每天自动同步</h2><p>使用 crontab 定时任务每天 <code>git push</code>一次</p><p>首先找个你喜欢的目录，创建一个脚本例如 <code>/root/backup_website.sh</code>，然后写入以下内容并保存</p><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">cd /www/wwwroot/xxx.com</span><br><span class="line">git add -A</span><br><span class="line">git commit -m &quot;backup&quot;</span><br><span class="line">ssh-add /root/github</span><br><span class="line">git push -u origin master -f</span><br></pre></td></tr></table></figure><div class="note info">            <p>可以把数据库也放在脚本一起备份，数据库备份语句在最下面哦</p>          </div><p>接着编辑 crontab 的配置文件，<code>crontab -e</code>,然后保存退出</p><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">30 3 * * * ssh-agent bash /root/backup_website.sh</span><br></pre></td></tr></table></figure><div class="note info">            <p>这样每天凌晨3:30的时候就会自动备份你的网站到 Github了</p>          </div><blockquote><p>题外话：由于本博主使用的是mysql数据库，所以是mysql数据库备份命令和思路！有需要备份数据库的把下面的脚本修改，放到上面的自动备份脚本就可以了。</p></blockquote><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">!/bin/bash</span></span><br><span class="line">DATE=`date +%Y-%m-%d`  #现在的时间</span><br><span class="line">DATE1=`date +%Y-%m-%d --date=&#x27;-7 day&#x27;` #设定一个需要删除的时间，我这里设置的的7天以前的删除</span><br><span class="line">mysqldump -u数据库用户名 -p密码 数据库名字 &gt; /www/wwwroot/sqlbackup/typecho.sql.$&#123;DATE&#125; #备份到网站目录下的sqlbackup文件夹</span><br><span class="line">rm -rf /www/wwwroot/sqlbackup/typecho.sql.$&#123;DATE1&#125; #删除7天之前的备份文件</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 备份网站数据 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
